# Template System Guide

Complete guide to customizing and creating templates for the Auto-Init system.

---

## Table of Contents

- [Overview](#overview)
- [Template Structure](#template-structure)
- [Placeholders](#placeholders)
- [Conditional Sections](#conditional-sections)
- [Creating New Templates](#creating-new-templates)
- [Best Practices](#best-practices)
- [Examples](#examples)

---

## Overview

The Auto-Init system uses **markdown templates** with placeholders that get replaced with project-specific values during generation.

**Template Location:** `.claude/templates/auto-init/`

**Template Types:**
- Framework-specific (nextjs, fastapi, django, etc.)
- Generic fallback
- Agent-specific guidance

---

## Template Structure

### Basic Template

```markdown
# PROJECT MEMORY - {{PROJECT_NAME}}

## Project Overview
- **Framework**: {{FRAMEWORK}} {{FRAMEWORK_VERSION}}
- **Package Manager**: {{PACKAGE_MANAGER}}
- **Test Framework**: {{TEST_FRAMEWORK}}

## Framework Patterns

[Framework-specific best practices]

## Dependencies
- {{DEPENDENCIES_LIST}}

---
*Generated by Auto-Init on {{GENERATED_DATE}}*
```

### Template Sections

1. **Header:** Project name and metadata
2. **Overview:** Quick reference (framework, versions, tools)
3. **Patterns:** Framework-specific best practices
4. **File Structure:** Directory organization
5. **Common Tasks:** Frequent operations
6. **Dependencies:** Key libraries
7. **Footer:** Generation metadata

---

## Placeholders

### Available Placeholders

| Placeholder | Description | Example Value |
|-------------|-------------|---------------|
| `{{PROJECT_NAME}}` | Directory name | "my-nextjs-app" |
| `{{FRAMEWORK}}` | Framework name | "Next.js" |
| `{{FRAMEWORK_VERSION}}` | Framework version | "14.2.5" |
| `{{PACKAGE_MANAGER}}` | Package manager | "npm", "yarn", "pnpm", "uv" |
| `{{TEST_FRAMEWORK}}` | Test framework | "jest", "pytest", "vitest" |
| `{{ROUTER_TYPE}}` | Router type (Next.js) | "App Router", "Pages Router" |
| `{{DEPENDENCIES_LIST}}` | Top 10 dependencies | "next (14.2.5), react (18.0.0), ..." |
| `{{GENERATED_DATE}}` | Generation date | "2025-12-15" |
| `{{PROJECT_PATH}}` | Full project path | "C:\\Projects\\my-app" |
| `{{HAS_TESTS}}` | Tests detected | true, false |
| `{{CONFIDENCE}}` | Detection confidence | 95 (0-100) |
| `{{CODE_STYLE}}` | User preference | "functional", "OOP" |

### Framework-Specific Placeholders

**Next.js:**
- `{{SERVER_COMPONENTS}}` - true/false
- `{{API_ROUTES}}` - true/false

**FastAPI:**
- `{{ASYNC_SUPPORT}}` - true/false
- `{{PYDANTIC_VERSION}}` - "v1", "v2"

**Django:**
- `{{APPS_STRUCTURE}}` - true/false
- `{{MIGRATIONS}}` - true/false

**Go:**
- `{{MODULES_SUPPORT}}` - true/false

### Usage in Templates

```markdown
## Project: {{PROJECT_NAME}}

This {{FRAMEWORK}} project uses {{PACKAGE_MANAGER}} for dependency management.

Framework version: {{FRAMEWORK_VERSION}}
Detection confidence: {{CONFIDENCE}}%
```

---

## Conditional Sections

### Syntax

```markdown
{{#IF CONDITION}}
Content shown only if CONDITION is true
{{/IF}}
```

### Examples

**Next.js Server Components:**
```markdown
{{#IF SERVER_COMPONENTS}}
## Server Components Best Practices

- Use `async` functions for data fetching
- Keep components simple and composable
- Prefer Server Components by default
{{/IF}}
```

**FastAPI Async Support:**
```markdown
{{#IF ASYNC_SUPPORT}}
## Async Patterns

```python
@app.get("/items")
async def read_items():
    data = await fetch_from_db()
    return data
```
{{/IF}}
```

**Testing:**
```markdown
{{#IF HAS_TESTS}}
## Testing

Tests detected. Run with:
```bash
{{PACKAGE_MANAGER}} test
```
{{/IF}}
```

---

## Creating New Templates

### Step 1: Create Template File

```powershell
# Create new template
New-Item -Path "~/.claude/templates/auto-init/my-framework.template.md" -ItemType File

# Edit template
code ~/.claude/templates/auto-init/my-framework.template.md
```

### Step 2: Define Template Content

```markdown
# PROJECT MEMORY - {{PROJECT_NAME}}

## Project Overview
- **Framework**: My Framework {{FRAMEWORK_VERSION}}
- **Type**: Custom framework
- **Package Manager**: {{PACKAGE_MANAGER}}

## My Framework Patterns

### Pattern 1: Configuration
```javascript
export default {
  // Framework-specific config
}
```

### Pattern 2: Routing
```javascript
// Routing example
```

## Dependencies
- {{DEPENDENCIES_LIST}}

---
*Generated on {{GENERATED_DATE}}*
```

### Step 3: Update Selector Mapping

Edit `.claude/scripts/auto-init/selector.ps1`:

```powershell
# Around line 40 - Add to template map
$templateMap = @{
    # ... existing mappings ...
    "my-framework"  = "my-framework.template.md"
}
```

### Step 4: Update Scanner Detection

Edit `.claude/scripts/auto-init/scanner.ps1`:

```powershell
# Add detection logic
if (Test-Path (Join-Path $projectPath "my-framework.config")) {
    $framework = @{
        name = "My Framework"
        version = "1.0.0"  # Extract from config
    }
    $projectType = "my-framework"
    $confidence = 95
}
```

### Step 5: Add Framework-Specific Variables

In `selector.ps1`, add custom variables:

```powershell
switch ($scanResult.projectType) {
    "my-framework" {
        $variables.MY_CUSTOM_VAR = $true
        $variables.ANOTHER_VAR = "value"
    }
}
```

### Step 6: Test

```powershell
# Navigate to test project
cd C:\Projects\my-framework-project

# Run auto-init
/init-claude

# Verify generated file
cat CLAUDE.md
```

---

## Best Practices

### 1. Keep Templates Framework-Specific

**Good:**
```markdown
## Next.js App Router Patterns

- Use Server Components for data fetching
- Client Components for interactivity
- Route Handlers for API endpoints
```

**Bad:**
```markdown
## General React Patterns

- Use React best practices
- Follow community standards
```

### 2. Provide Concrete Examples

**Good:**
```markdown
### Server Component Example
```typescript
// app/page.tsx
export default async function Page() {
  const data = await fetch('https://api.example.com/data')
  return <div>{data.title}</div>
}
```
```

**Bad:**
```markdown
### Server Components
Use async functions to fetch data.
```

### 3. Organize Logically

Recommended sections:
1. Project Overview (metadata)
2. Framework Patterns (specific practices)
3. File Structure (organization)
4. Common Tasks (frequently used commands)
5. Testing (if applicable)
6. Dependencies (key libraries)

### 4. Balance Detail vs. Brevity

- Aim for templates between 200-500 lines
- Detailed enough to be useful immediately
- Brief enough to scan in < 5 minutes
- Link to external docs for deep dives

### 5. Use Semantic Placeholders

**Good:**
```markdown
Package Manager: {{PACKAGE_MANAGER}}
```

**Bad:**
```markdown
Tool: {{PM}}
```

---

## Examples

### Example 1: Custom React Native Template

```markdown
# PROJECT MEMORY - {{PROJECT_NAME}}

## Project Overview
- **Framework**: React Native {{FRAMEWORK_VERSION}}
- **Platform**: iOS & Android
- **Package Manager**: {{PACKAGE_MANAGER}}

## Mobile Development Patterns

### Navigation
```typescript
import { NavigationContainer } from '@react-navigation/native'
import { createNativeStackNavigator } from '@react-navigation/native-stack'

const Stack = createNativeStackNavigator()
```

### State Management
{{#IF REDUX_DETECTED}}
Using Redux Toolkit for state management.
{{/IF}}

## Platform-Specific Code
```typescript
import { Platform } from 'react-native'

const styles = StyleSheet.create({
  container: {
    padding: Platform.OS === 'ios' ? 20 : 10
  }
})
```

## Dependencies
- {{DEPENDENCIES_LIST}}
```

### Example 2: Rust + Actix Web Template

```markdown
# PROJECT MEMORY - {{PROJECT_NAME}}

## Project Overview
- **Language**: Rust {{RUST_VERSION}}
- **Framework**: Actix Web {{FRAMEWORK_VERSION}}
- **Package Manager**: Cargo

## Actix Web Patterns

### Route Handlers
```rust
use actix_web::{get, web, App, HttpResponse, HttpServer, Responder};

#[get("/")]
async fn index() -> impl Responder {
    HttpResponse::Ok().body("Hello world!")
}
```

### Async Runtime
- Using Tokio runtime
- Async handlers by default
- Connection pooling with r2d2

## Project Structure
```
src/
├── main.rs           # Application entry
├── routes/           # Route handlers
├── models/           # Data models
├── db/               # Database layer
└── config/           # Configuration
```

## Dependencies
- actix-web
- tokio
- serde
- sqlx
```

---

## Template Variables Reference

### Adding Custom Variables

**In selector.ps1:**
```powershell
# Define custom variables (line ~79)
$variables = @{
    # Standard variables
    PROJECT_NAME        = $projectName
    FRAMEWORK           = $scanResult.framework.name

    # Custom variables
    MY_CUSTOM_VAR       = "custom value"
    FEATURE_ENABLED     = $true
}
```

**In template:**
```markdown
## Custom Section
- Setting: {{MY_CUSTOM_VAR}}

{{#IF FEATURE_ENABLED}}
Feature is enabled!
{{/IF}}
```

### Extracting from Project Files

```powershell
# Read package.json
$packageJson = Get-Content -Path (Join-Path $projectPath "package.json") | ConvertFrom-Json

# Extract custom field
$variables.CUSTOM_FIELD = $packageJson.customField

# Read tsconfig.json
$tsconfig = Get-Content -Path (Join-Path $projectPath "tsconfig.json") | ConvertFrom-Json
$variables.TS_STRICT = $tsconfig.compilerOptions.strict
```

---

## Troubleshooting

### Placeholder Not Replaced

**Problem:** `{{MY_VAR}}` appears in generated file

**Solution:**
- Check variable is defined in `selector.ps1` `$variables` hash
- Ensure variable name matches exactly (case-sensitive)
- Verify no typos in placeholder syntax

### Conditional Not Working

**Problem:** Content shows even when condition is false

**Solution:**
- Ensure condition variable is boolean: `$true` or `$false` (not `"true"` string)
- Check conditional syntax: `{{#IF VAR}}...{{/IF}}`
- Verify variable exists in `$variables` hash

### Template Not Selected

**Problem:** Wrong template used for project

**Solution:**
- Check `$templateMap` in `selector.ps1` includes your project type
- Verify scanner.ps1 correctly sets `$projectType`
- Check detection confidence (must be > 0)

---

## Next Steps

- **Read:** [api.md](./api.md) - PowerShell script API reference
- **Read:** [troubleshooting.md](./troubleshooting.md) - Common issues
- **Explore:** Example templates in `.claude/templates/auto-init/`

---

**Version:** 2.0.0
**Last Updated:** 2025-12-15
